<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% include "partials/resources.html" %}
    <link rel="icon" href="{% static 'img/logo_betech.png' %}">
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}">
    <link rel="stylesheet" href="{% static 'styles/styles-home.css' %}">
    <script src="{% static 'js/home.js' %}"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/decimal.js@10.3.1/decimal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script src="https://kit.fontawesome.com/c3469abfa1.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPP - Home</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>
<body>
    {% include "partials/header.html" %}
    {% if alert_message %}
    <div class="popup2" id="popup2">
        <div class="popup2-content">
            <h2>Aviso</h2>
            <p>{{ alert_message }}</p>
            <button class="popup2-close-button" id="popup2-close-button">Cerrar</button>
        </div>
    </div>
{% endif %}
    <div id="welcome-popup" class="popup-overlay-pedidos">
        <div class="popup-content-pedidos">
            {% comment %} Revisar si estos comentarios son necesarios {% endcomment %}

        </div>
    </div>
    
    <!--Formulario para crear pedidos en la vista principal-->
    <div class="form-container-productos">

        {% comment %} {% endcomment %}
        <!-- Popup Container -->
        <div id="popupContainer" class="popup-container" style="display: none;">
            <form class="formimport" method="POST" enctype="multipart/form-data" action="{% url 'importar' %}">
                {% csrf_token %}
                <h2 class="bold-heading">Seleccionar Método de Carga</h2>
                <hr>
                <h2 class="Excel">Cargar Archivo Excel</h2>
                <div class="button-row">
                    <div class="button-container">
                        <a href="{% url 'descargar_excel' 'Plantilla_ejemplo.xlsx' %}" class="left-button">
                            <button type="button" class="carga-button-bot">Descargar Plantilla</button>
                        </a>
                    
                        <div class="right-button">
                            <div class="custom-file-input">
                                <input type="file" name="xlsfile" id="fileInput">
                                <label for="fileInput">Seleccionar archivo</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-row">
                        <span id="file-name-display" class="file-name">Ningún archivo seleccionado</span>
                        <button type="submit" class="subir" name="subir">Subir Archivo</button>
                    </div>
                </div>
                <!-- Close button without submitting the form -->
                <h2 class="agregar">Agregar Pedido Manualmente</h2>
                <div class="button-row">
                        <button type="button" id="toggle-carga-button" class="carga-button-bot" onclick="toggleCargaForm()">Abrir Formulario</button>
                        <button type="button" class="popup-close-pedidos" onclick="closePopupimport()">x</button>
                    </div> 
            </form>
        </div>
    </div>
    <div class="form-container-productos" style="width:150;">
       
        <form method="post" action="{% url 'pedidos' %}" style="display: none;" id="carga-form">
            {% csrf_token %}
            <table class="form-table">
                <th>Detalle Pedido</th>
                {{ detalle_pedido_formset.management_form }}
                <tr>
                    <th class="detalle-pedido-t">OP</th>
                    <th class="detalle-pedido-t">Cliente</th>
                   <th class="detalle-pedido-t">Mercado</th>
                   <th class="detalle-pedido-t">ETA</th>
                   <th class="detalle-pedido-t">Destino</th>
                   <th class="detalle-pedido-t" style="width:20vh;" >Programa</th>
                    <th class="detalle-pedido-t">Item</th>
                    <th class="detalle-pedido-t">Nombre producto</th>
                   <th class="detalle-pedido-t">Est</th>
                   <th class="detalle-pedido-t">term</th>
                   <th class="detalle-pedido-t">Calidad</th>
                </tr>
                {% for form in detalle_pedido_formset %}
                <tr>
                    <td>{{ pedido_form.orden_interna }}</td>
                    <td>{{ pedido_form.cliente }}</td>
                    <td>{{ form.mercado}}</td>              
                    <td>{{ pedido_form.fecha_entrega }}</td>
                    <td>{{ form.puerto_destino }}</td>
                    <td>{{ form.programa }}</td>
                    <td>{{ form.item }}</td>              
                    <td>{{ form.producto }}</td>
                    <td>{{ form.est }}</td>
                    <td>{{ form.term }}</td>
                    <td>{{ form.calidad }}</td>
                </tr>
            </table>
                <table class="form-table">

                <tr>
                   <th class="detalle-pedido-t a">Esp. Producc <br> (cm)</th>
                   <th class="detalle-pedido-t a">Anc. Producc <br> (cm)</th>
                   <th class="detalle-pedido-t a">Lar. Producc <br> (cm)</th>
                   <th class="detalle-pedido-t">Pzas</th>
                   <th class="detalle-pedido-t">M3</th>
                   <th class="detalle-pedido-t ">Mbf</th>
                    <th class="detalle-pedido-t ">Baño</th>
                   <th class="detalle-pedido-t">Marca</th>
                   <th class="detalle-pedido-t">Fecha Creacion</th>
                   <th class="detalle-pedido-t">Comentario</th>
                   <th class="detalle-pedido-t">Version</th>
                   <th class="detalle-pedido-t">Estado</th>
                </tr>
       
                <tr>              
                    <td>{{ form.alto_producto }}</td>
                    <td>{{ form.ancho_producto }}</td>
                    <td>{{ form.largo_producto }}</td>
                    <td>{{ form.piezas }}</td>
                    <td>{{ form.volumen_producto }}</td>
                    <td>{{ form.mbf }}</td>
                    <td>{{ form.banio}}</td>
                    <td>{{ form.marca}}</td>
                    <td>{{ pedido_form.fecha_produccion }}</td>
                    <td>{{ pedido_form.comentario }}</td>
                    <td>{{ pedido_form.version }}</td>
                    <td>{{ pedido_form.estado }}</td>
               
                </tr>
            
            </table>
            <table class="form-table">
               <th>Detalle Factura</th>
            <tr>
                <th class="detalle-pedido-t" >FSC</th>
                <th class="detalle-pedido-t a">Esp.Fact <br> (cm)</th>
                <th class="detalle-pedido-t a">Anc.Fact <br> (cm)</th>
                <th class="detalle-pedido-t a">Lar.Fact <br> (cm)</th>
            </tr>       
            <tr>
                <td>{{ form.FSC }}</td>
                <td>{{ form.esp_fact }}</td>
                <td>{{ form.anc_fact }}</td>
                <td>{{ form.lar_fact }}</td>
            </tr>
        </table>
    <table>
            <th>Detalle Paquete</th>
            <tr>
                <th class="detalle-pedido-t">Tipo Empaque</th>
                <th class="detalle-pedido-t">Alto Paquete <br> (cm)</th>
                <th class="detalle-pedido-t">Ancho Paquete <br> (cm)</th>
                <th class="detalle-pedido-t">Int.paquete</th>
                <th class="detalle-pedido-t">Pqte</th>
            </tr>
            <tr>
                <td>{{ form.tipo_empaque }}</td>
                <td>{{ form.alto_paquete }}</td>
                <td>{{ form.anc_paquete }}</td>
                <td>{{ form.int_paquete }}</td>
                <td>{{ form.pqte }}</td>
            </tr>
        </table>
      {% endfor %}
            <button type="submit" name="crear" class="red-button">Crear</button>    
            <button class="form-close-x" onclick="closePopup()">x</button>
        </form>
    </div>
   

    <br>
    {% comment %} Mover estilo {% endcomment %}
    <div class="table-container">

        <div class="title-container">
            <h4 id="titulo">Pedidos JCE</h4>
            <span id="titulofecha">{{ titulofecha }}</span>
        </div>
        <div id="gantt">
            <script>
                const tasksData = {{ tasks|safe }};
            </script>
        </div>
        
    </div>

    <div class="buttons-bot">

        {% comment %} <button type="button" id="toggle-ejecutar-button" class="carga-button-bot"
            onclick="/* showPopup() */hidePopup()   ">Ejecutar</button> {% endcomment %}
            
            <button type="button" class="carga-button" id="openPopupButtontest">Algoritmo</button>

    </div>

{% comment %} popup ALGORINTO {% endcomment %}
<div id="popupContainertest" style="width:30%; height:70%;" class="popup">
    <!-- Add your popup content here -->
    <span class="close" id="closePopupButton">&times;</span>

    <table id="diameterTable" style="width:100%;">
        <thead>
            <tr>
                <th>Diametro</th>
            </tr>
        </thead>
        <tbody id="diameterBody">
            <!-- Diameter results will be displayed here -->
        </tbody>
    </table>

    <table id="selectedTable" style="width:100%;" > 
        <thead>
            <tr>
                <th>Selected</th>
            </tr>
        </thead>
        <tbody id="selectedBody">
            <!-- Selected results will be displayed here -->
        </tbody>
    </table>
</div>

<!--action= asignar_folio_pedido
<div class="popup-folio-container" id="popup3">
    <form method="POST" class="formulario">
        {% csrf_token %}
        <div class="popup-folio-content">
            <h2 class="popup-folio-title">Crear folio</h2>
            <div id="productos-seleccionados"></div>
            <input type="text" name="texto_folio" placeholder="Ingrese el folio">
            <button type="submit" class="popup-folio-button">Agregar Folio</button>
            <button type="button" class="popup-folio-button agregar-folio-button" id="cerrar-popup-button">Cerrar</button>
        </div>
    </form>
</div>-->   
<script src="{% static 'js/gantt.js' %}"></script>

{% comment %} script test algoritmo popup {% endcomment %}
<script>
    const openButton = document.getElementById("openPopupButtontest");
    const closeButton = document.getElementById("closePopupButton");
    const popupContainertest = document.getElementById("popupContainertest");
    const diameterTable = document.getElementById("diameterTable");
    const diameterBody = document.getElementById("diameterBody");
    const selectedTable = document.getElementById("selectedTable");
    const selectedBody = document.getElementById("selectedBody");

    // Function to open the popup
    openButton.addEventListener("click", function () {
        // Show loading message while waiting for results
        diameterBody.innerHTML = "<tr><td>Loading...</td></tr>";
        selectedBody.innerHTML = "<tr><td>Loading...</td></tr>";
        
        // Make an AJAX request to execute_code view
        fetch("/execute_code/your-archivo1/your-archivo2/")
            .then(response => response.json())
            .then(data => {
                // Clear the loading messages
                diameterBody.innerHTML = "";
                selectedBody.innerHTML = "";

                // Populate the "Diameter" table with results
                for (let i = 0; i < data.diametro.length; i++) {
                    const row = document.createElement("tr");
                    const diameterCell = document.createElement("td");
                    diameterCell.innerText = data.diametro[i];
                    row.appendChild(diameterCell);
                    diameterBody.appendChild(row);
                }

                // Populate the "Selected" table with results
                for (let i = 0; i < data.selected.length; i++) {
                    const row = document.createElement("tr");
                    const selectedCell = document.createElement("td");
                    selectedCell.innerText = data.selected[i];
                    row.appendChild(selectedCell);
                    selectedBody.appendChild(row);
                }
            })
            .catch(error => {
                console.error("An error occurred:", error);
                diameterBody.innerHTML = "<tr><td>An error occurred while fetching Diameter results.</td></tr>";
                selectedBody.innerHTML = "<tr><td>An error occurred while fetching Selected results.</td></tr>";
            });

        // Show the popup
        popupContainertest.style.display = "block";
    });

    // Function to close the popup
    closeButton.addEventListener("click", function () {
        popupContainertest.style.display = "none";
    });
</script>

</script>
{% comment %}  {% endcomment %}
<script>
    $(document).ready(function() {
        $('.select2').select2({
            multiple: true,
            closeOnSelect: false,          
            placeholder: 'Seleccione una opción'
        });
                // Handle padding when Select2 dropdown is opened
        $('.select2').on('select2:open', function() {
            $(this).closest('td').find('.select2-dropdown').css('padding', 'px'); // Apply default padding
        });
    });
</script>

<script>
    $(document).ready(function() {
        // Escucha cambios en el input[type="file"]
        $('input[type="file"]').change(function() {
            var fileName = $(this).val().split('\\').pop(); // Obtén el nombre del archivo seleccionado
            $('#file-name-display').text(fileName); // Muestra el nombre del archivo en el span
        });
    });
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
        const popup = document.getElementById("popup2");
        const popupCloseButton = document.getElementById("popup2-close-button");

        // Muestra el popup si alert_message tiene un valor
        if (popup && popupCloseButton) {
            popup.style.display = "block";
            
            
            // Cierra el popup cuando se hace clic en el botón "Cerrar"
            popupCloseButton.addEventListener("click", function () {
                popup.style.display = "none";
            });
        }


    });
</script>

{% comment %} Ejecutar ALGORITMO DE TEST {% endcomment %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $("#toggle-ejecutar-button").click(function() {
        // Specify the values for archivo1 and archivo2
        var archivo1Value = "LineaDelgado.csv";  // Update with the actual value
        var archivo2Value = "LineaGruesa.csv";   // Update with the actual value

        // Construct the URL for the execute_code view
        var url = `/execute_code/${archivo1Value}/${archivo2Value}/`;

        $.ajax({
            url: url,
            type: "GET",
            success: function(response) {
                // Handle the response from the server (if needed)
                console.log(response);
            },
            error: function(error) {
                // Handle any errors (if needed)
                console.error(error);
            }
        });
    });
});
$(document).ready(function() {
    $('#gantt').DataTable({
        "paging": true, // Habilita la paginación
        "pageLength": 10 // Número de filas por página (puedes cambiar este valor)
    });
});
</script>
</html>
